ğŸ“˜ M9.1 â€” Outlook Draft Export Helper
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“˜ Objective:
Add M9.1 â€” Outlook Draft Export Helper. Take the bilingual HTML generated by M9 and produce a ready-to-open email draft:
- On Windows + Outlook: save a .msg draft via COM (no sending).
- On all platforms: save a standards-compliant .eml draft with attachments.
Drafts land under /outputs/publication/drafts/. Fully assistive â€” human sends.

ğŸ“‚ Files to create/update:
- /src/ai/publication_msg_helper.py         # core helper & CLI
- /docs/prompts/module-09.1.txt             # save this prompt
- /src/context/ProjectVision.ts             # add M9.1 line in roadmap
- (no template changes; reuse M9 HTML outputs)

ğŸ”§ Dependencies:
- Optional (Windows only): pywin32==306
- Built-in: email, mimetypes, base64, pathlib
ğŸ‘‰ In requirements.txt, append:
# Windows optional for .msg export
pywin32>=306; platform_system == "Windows"

âš ï¸ Compliance:
# Assistive only. Prepare drafts; do NOT send emails automatically.
# Preserve validated Excel macros; do NOT modify MTCR Data.xlsm.
# Log actions to /logs/publication_agent_YYYYMM.jsonl (append mode).

ğŸ§  Key Functions:
- save_eml() â†’ Cross-platform .eml with HTML + attachments
- save_msg() â†’ Windows .msg via Outlook COM (requires pywin32)
- create_draft() â†’ Main orchestrator with JSONL logging
- _collect_attachments() â†’ Handle relative/absolute paths
- _load_html() â†’ Load M9 HTML outputs or explicit path

ğŸ§ª Quick test (cross-platform .eml):
# After running M9 to generate HTML:
python -m src.ai.publication_msg_helper \
  --month 2025-10 \
  --locale en \
  --subject "[MTCR] Monthly Review Summary â€” October 2025" \
  --reviewer "CHP Governance" \
  --attach outputs/publication/publication_email_202510_en.html

# Result:
# outputs/publication/drafts/MTCR_Review_Summary_202510_en.eml
# logs/publication_agent_202510.jsonl (appended)

ğŸ§ª Windows test (.msg) â€” optional:
# Ensure Outlook desktop app + pywin32 installed.
python -m src.ai.publication_msg_helper ^
  --month 2025-10 ^
  --locale fr ^
  --subject "[MTCR] RÃ©sumÃ© Mensuel â€” Octobre 2025" ^
  --reviewer "CHP Governance" ^
  --to "someone@biomerieux.com" "team@biomerieux.com" ^
  --cc "quality@biomerieux.com" ^
  --attach outputs/publication/publication_email_202510_fr.html

# Result:
# outputs/publication/drafts/MTCR_Review_Summary_202510_fr.msg

âœ… Acceptance checklist:
- [ ] .eml draft opens correctly in mail clients (HTML preserved, attachments present).
- [ ] On Windows, .msg draft opens in Outlook as a ready-to-send message.
- [ ] JSONL entry appended with reviewer, timestamp, attachments, sha256.
- [ ] No auto-send behavior present anywhere (assistive only).

ğŸ“ ProjectVision.ts note:
Add under Phase M9 line:
- "M9.1 â€” Outlook Draft Export Helper: builds .msg (Windows) or .eml (cross-platform) drafts from M9 HTML + attachments. Assistive only."
